<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.wildsoft.shopping_mall.shop.ShopDao">

  <!-- 상품 -->
  <select id="getProductList"
    parameterType="com.wildsoft.shopping_mall.shop.ProductVO"
    resultType="com.wildsoft.shopping_mall.shop.ProductVO">
    <![CDATA[
      select rnum, q.*
      from (
        select
          row_number() over (order by product_id desc) as rnum,
          k.*
        from (
          select * from products where 1=1
    ]]>
    <if test="search_type == 'product_name'">
    <![CDATA[
          and product_name like concat('%', #{search_value}, '%')
    ]]>
    </if>
    <if test="search_type == 'category'">
    <![CDATA[
          and category like concat('%', #{category}, '%')
    ]]>
    </if>
    <if test="search_type == 'created_at'">
    <![CDATA[
          and created_at like concat('%', #{created_at}, '%')
    ]]>
    </if>
    <![CDATA[
        ) k
      ) q
      where rnum between #{start} and #{end}
    ]]>
  </select>

	<select id="getProductsCount" resultType="int">
    select count(*) as total_count from products
  </select>

  <select id="getProduct" 
    parameterType="com.wildsoft.shopping_mall.shop.ProductVO"
    resultType="com.wildsoft.shopping_mall.shop.ProductVO">
      select * from products where product_id = #{product_id}
  </select>

  <insert id="insertProduct" parameterType="com.wildsoft.shopping_mall.shop.ProductVO">
    insert into products (product_name, product_description, product_price, stock_quantity, category)
    values (#{product_name}, #{product_description}, #{product_price}, #{stock_quantity}, #{category})
  </insert>

  <update id="updateProduct" parameterType="com.wildsoft.shopping_mall.shop.ProductVO">
    update products
    <set>
      <if test="product_name != null">product_name = #{product_name},</if>
      <if test="product_description != null">product_description = #{product_description},</if>
      <if test="product_price != 0">product_price = #{product_price},</if>
      <if test="stock_quantity != 0">stock_quantity = #{stock_quantity},</if>
      <if test="category != null">category = #{category},</if>
    </set>
    where product_id = #{product_id}
  </update>

  <delete id="deleteProduct" parameterType="com.wildsoft.shopping_mall.shop.ProductVO">
    delete from products where product_id = #{product_id}
  </delete>
</mapper>